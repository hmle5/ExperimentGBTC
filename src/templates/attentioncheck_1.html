<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attention Check</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f8f9fa;
        }

        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .error-text {
            font-size: 0.9rem;
        }
    </style>
    <script>
        function countWords(text) {
            return text.trim().split(/\s+/).filter(word => word.length > 0).length;
        }

        function isGibberish(text) {
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const uniqueWords = new Set(words.map(w => w.toLowerCase()));

            const mostlyShort = words.filter(w => w.length < 3).length / words.length > 0.4;
            const tooRepetitive = uniqueWords.size / words.length < 0.5;
            const nonAlpha = words.filter(w => !/^[a-zA-Z]+$/.test(w)).length / words.length > 0.3;

            return mostlyShort || tooRepetitive || nonAlpha;
        }

        function validateInput() {
            const text = document.getElementById("response").value;
            const wordCount = countWords(text);
            const button = document.getElementById("continueButton");
            const warning = document.getElementById("validationWarning");

            if (wordCount >= 15 && !isGibberish(text)) {
                button.disabled = false;
                warning.style.display = "none";
            } else {
                button.disabled = true;
                warning.style.display = "block";
            }
        }

        window.onload = function () {
            const textarea = document.getElementById("response");
            textarea.addEventListener("paste", e => e.preventDefault()); // Disable paste
            validateInput();  // Disable button initially
        };
    </script>
</head>

<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white text-center">
                        <h2>Welcome!</h2>
                    </div>
                    <div class="card-body">
                        {% if error %}
                        <div class="text-danger mb-4 text-center fw-bold">
                            {{ error }}
                        </div>
                        {% endif %}

                        <p>This study is intended for computer users only (e.g., desktop or laptop). If you are
                            accessing this survey from a smartphone, a tablet or a non-PC device, we recommend that you
                            switch to a desktop or laptop and enter the study again.</p>

                        <p>Please write in the box below a short sentence of about 15 words describing your opinion on
                            the idea of shortening the work week. Your stance on the issue does not affect your
                            participation in this study. We simply would like to ask that you share at least 15 words
                            about your thoughts on this topic.</p>

                        <form method="post" action="{{ url_for('main.attentioncheck_1') }}">
                            <div style="display: none;">
                                <label for="website">Leave this field empty</label>
                                <input type="text" name="website" id="website" autocomplete="off">
                            </div>
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="mb-4">
                                <textarea class="form-control" id="response" name="response" rows="4"
                                    oninput="validateInput()"></textarea>
                            </div>

                            <div id="validationWarning" class="text-danger mb-3 fw-bold" style="display: none;">
                                Please type at least 15 real words. Avoid copy-pasting or entering gibberish.
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg" id="continueButton" disabled>
                                    Continue
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>