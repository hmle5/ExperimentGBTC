<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Thank You</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function downloadCode() {
            const prolificId = "{{ prolific_id }}";
            const code = "{{ completion_code }}";
            const content = `Prolific ID: ${prolificId}\nCompletion Code: ${code}`;
            const blob = new Blob([content], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "survey_completion.txt";
            link.click();
        }

        function confirmClose() {
            if (confirm("Are you sure you want to close this tab? ...")) {
                window.open('', '_self');
                window.close();

                // Fallback alert if it fails
                setTimeout(() => {
                    alert("If the tab didn't close, please close it manually.");
                }, 500);
            }
        }
    </script>
</head>

<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card border-info">
                    <div class="card-header bg-info text-white">
                        <h3>You're All Set!</h3>
                    </div>
                    <div class="card-body">
                        <p class="fs-5">Thank you for completing the survey!</p>
                        <p>Please copy or download your code below and submit it on MTurk to receive your payment.</p>

                        <div class="alert alert-primary text-center">
                            <strong>Prolific ID:</strong> {{ prolific_id }}<br>
                            <strong>Completion Code:</strong><br>
                            <span class="fs-4 text-success">{{ completion_code }}</span>
                        </div>

                        <button class="btn btn-outline-primary me-2" onclick="downloadCode()">Download
                            Confirmation</button>
                        <button class="btn btn-outline-danger" onclick="confirmClose()">Close Tab</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>